class MusicianSite{constructor(){this.navbar=document.getElementById("navbar"),this.hamburger=document.getElementById("hamburger"),this.navMenu=document.getElementById("nav-menu"),this.videoModal=document.getElementById("video-modal"),this.modalVideo=document.getElementById("modal-video"),this.heroVideo=document.getElementById("hero-video"),this.videoPlayBtn=document.getElementById("video-play-btn"),this.contactForm=document.getElementById("contact-form"),this.init()}init(){this.setupNavigation(),this.setupScrollEffects(),this.setupVideoHandlers(),this.setupContactForm(),this.setupAnimations(),this.setupSmoothScrolling(),this.setupParallaxOptimizations()}setupNavigation(){this.hamburger.addEventListener("click",()=>{this.navMenu.classList.toggle("active"),this.hamburger.classList.toggle("active")}),document.querySelectorAll(".nav-link").forEach(e=>{e.addEventListener("click",()=>{this.navMenu.classList.remove("active"),this.hamburger.classList.remove("active")})}),document.addEventListener("click",e=>{this.navMenu.contains(e.target)||this.hamburger.contains(e.target)||(this.navMenu.classList.remove("active"),this.hamburger.classList.remove("active"))})}setupScrollEffects(){let e=window.scrollY;const t=document.querySelector(".hero"),s=document.querySelector(".hero-overlay"),i=document.querySelectorAll(".parallax-layer");let o=!1,a=!0;const n=new IntersectionObserver(e=>{e.forEach(e=>{a=e.isIntersecting})},{rootMargin:"100px 0px"});t&&n.observe(t);const c=()=>{const n=window.scrollY;n>100?this.navbar.classList.add("scrolled"):this.navbar.classList.remove("scrolled"),t&&a&&n<1.2*window.innerHeight&&(i.forEach(e=>{const t=parseFloat(e.dataset.speed)||0,s=n*t;e.style.transform=`translate3d(0, ${s}px, 0)`}),s&&(s.style.transform=`translate3d(0, ${.4*n}px, 0)`)),this.updateActiveNavLink(),e=n,o=!1};window.addEventListener("scroll",()=>{o||(requestAnimationFrame(c),o=!0)},{passive:!0}),c()}updateActiveNavLink(){const e=document.querySelectorAll("section[id]"),t=window.scrollY+100;e.forEach(e=>{const s=e.offsetTop,i=e.offsetHeight,o=e.getAttribute("id"),a=document.querySelector(`.nav-link[href="#${o}"]`);t>=s&&t<s+i&&(document.querySelectorAll(".nav-link").forEach(e=>{e.classList.remove("active")}),a&&a.classList.add("active"))})}setupVideoHandlers(){const e=document.getElementById("video-poster-img"),t=document.getElementById("video-overlay");if(e&&this.heroVideo){const s=()=>{e.style.display="none",t.style.display="none",this.heroVideo.style.display="block",this.heroVideo.play()};e.addEventListener("click",s),t.addEventListener("click",s)}document.querySelectorAll(".play-btn").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const s=e.getAttribute("data-video");this.openVideoModal(s)})});const s=document.querySelector(".video-modal-close");s&&s.addEventListener("click",()=>{this.closeVideoModal()}),this.videoModal&&this.videoModal.addEventListener("click",e=>{e.target===this.videoModal&&this.closeVideoModal()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.closeVideoModal()}),window.addEventListener("popstate",e=>{this.videoModal&&"block"===this.videoModal.style.display&&this.closeVideoModal(!0)})}openVideoModal(e,t=!1){this.videoModal&&this.modalVideo&&(this.modalVideo.src=e,this.videoModal.style.display="block",document.body.style.overflow="hidden",t||history.pushState({modalOpen:!0},"",""),setTimeout(()=>{this.modalVideo.play().catch(e=>{console.log("Auto-play prevented:",e)})},100))}closeVideoModal(e=!1){if(this.videoModal&&this.modalVideo){this.videoModal.style.display="none",this.modalVideo.pause(),this.modalVideo.src="",document.body.style.overflow="auto";if(window.location.pathname.match(/^\/video\/(.+)$/)){window.history.pushState(null,"砖专 爪专 拽爪注转 |   - 拽  砖专","/"),document.title="砖专 爪专 拽爪注转 |   - 拽  砖专";const e=document.querySelector('link[rel="canonical"]');e&&(e.href="https://singwithalon.com/")}else!e&&window.history.state&&window.history.state.modalOpen&&history.back()}}setupContactForm(){this.contactForm&&this.contactForm.addEventListener("submit",e=>{e.preventDefault(),this.handleFormSubmission()})}async handleFormSubmission(){const e=new FormData(this.contactForm),t=Object.fromEntries(e),s=FormValidator.validateForm(t);if(s.length>0)return void this.showMessage(s.join("\n"),"error");const i=this.contactForm.querySelector('button[type="submit"]'),o=i.innerHTML;i.innerHTML='<i class="fas fa-spinner fa-spin"></i> 爪专 注...',i.disabled=!0;try{await this.sendWhatsAppMessage(t)}catch(e){console.error("WhatsApp message error:",e),this.showMessage("砖 爪专转 注转 WhatsApp.  住 砖.","error")}finally{i.innerHTML=o,i.disabled=!1}}async sendWhatsAppMessage(e){const t=e.date?new Date(e.date).toLocaleDateString("he-IL"):" 爪",s=`砖 ! \n\n 注/转  驻注:\n\n 砖: ${e.name}\n 驻: ${e.phone}\n 转专 注祝: ${t}\n\n 驻专 住驻:\n${e.message||" 爪 驻专 住驻"}\n\n砖 砖注  拽! `,i=`https://wa.me/972528962110?text=${encodeURIComponent(s)}`;await new Promise(e=>setTimeout(e,1e3));try{const e=window.open(i,"_blank","noopener,noreferrer");!e||e.closed||void 0===e.closed?window.location.href=i:(this.showMessage("注转 WhatsApp 爪专 爪! 驻驻 驻转 注 专注.","success"),this.contactForm.reset())}catch(e){console.log("Popup failed, using direct navigation:",e),window.location.href=i}return!0}showMessage(e,t){document.querySelectorAll(".form-message").forEach(e=>e.remove());const s=document.createElement("div");s.className=`form-message ${t}`,s.innerHTML=`\n            <i class="fas fa-${"success"===t?"check-circle":"exclamation-circle"}"></i>\n            <span>${e}</span>\n        `,s.style.cssText=`\n            display: flex;\n            align-items: center;\n            gap: 10px;\n            padding: 15px 20px;\n            margin-top: 20px;\n            border-radius: 10px;\n            font-weight: 500;\n            background: ${"success"===t?"#d4edda":"#f8d7da"};\n            color: ${"success"===t?"#155724":"#721c24"};\n            border: 1px solid ${"success"===t?"#c3e6cb":"#f5c6cb"};\n        `,this.contactForm.appendChild(s),setTimeout(()=>{s.remove()},5e3)}setupAnimations(){const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("visible")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".service-card, .testimonial-card, .video-card, .highlight-item").forEach(t=>{t.classList.add("fade-in"),e.observe(t)}),document.querySelectorAll(".services-grid .service-card").forEach((e,t)=>{e.style.animationDelay=.2*t+"s"}),document.querySelectorAll(".testimonials-grid .testimonial-card").forEach((e,t)=>{e.style.animationDelay=.2*t+"s"}),document.querySelectorAll(".videos-grid .video-card").forEach((e,t)=>{e.style.animationDelay=.1*t+"s"})}setupSmoothScrolling(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const s=e.getAttribute("href"),i=document.querySelector(s);if(i){const e=i.offsetTop-80;window.scrollTo({top:e,behavior:"smooth"})}})});const e=document.querySelector(".scroll-indicator");e&&e.addEventListener("click",()=>{const e=document.getElementById("about");e&&e.scrollIntoView({behavior:"smooth",block:"start"})})}setupParallaxOptimizations(){(navigator.hardwareConcurrency<=4||window.devicePixelRatio<1.5||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))&&document.querySelectorAll(".parallax-layer").forEach(e=>{e.style.filter="none"}),document.addEventListener("visibilitychange",()=>{const e=document.querySelectorAll(".parallax-layer");document.hidden?e.forEach(e=>{e.style.willChange="auto"}):e.forEach(e=>{e.style.willChange="transform"})});const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting?document.body.classList.add("parallax-active"):document.body.classList.remove("parallax-active")})},{threshold:.1}),t=document.querySelector(".hero");t&&e.observe(t)}debounce(e,t){let s;return function(...i){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),e(...i)},t)}}throttle(e,t){let s;return function(){const i=arguments,o=this;s||(e.apply(o,i),s=!0,setTimeout(()=>s=!1,t))}}}class FormValidator{static validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static validatePhone(e){return/^(\+972|0)([23489]|5[02468]|77)[0-9]{7}$/.test(e.replace(/[- ]/g,""))}static validateForm(e){const t=[];if((!e.name||e.name.length<2)&&t.push("砖    驻转 2 转"),FormValidator.validatePhone(e.phone)||t.push("住驻专 驻  转拽"),e.date){const s=new Date(e.date),i=new Date;i.setHours(0,0,0,0),s<i&&t.push("转专  转   注转")}else t.push("砖 专 转专");return t}}class PerformanceUtils{static lazyLoadImages(){if("IntersectionObserver"in window){const e=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){const s=e.target;s.src=s.dataset.src,s.classList.remove("lazy"),t.unobserve(s)}})});document.querySelectorAll("img[data-src]").forEach(t=>{e.observe(t)})}}static preloadCriticalImages(){}}class Chatbot{constructor(){this.chatWidget=document.getElementById("chatbot-widget"),this.chatToggle=document.getElementById("chat-toggle"),this.chatModal=document.getElementById("chat-modal"),this.chatClose=document.getElementById("chat-close"),this.chatMessages=document.getElementById("chat-messages"),this.chatInputField=document.getElementById("chat-input-field"),this.chatSend=document.getElementById("chat-send"),this.chatTyping=document.getElementById("chat-typing"),this.chatTooltip=document.getElementById("chat-tooltip"),this.isOpen=!1,this.isTyping=!1,this.API_BASE_URL="https://singwithalon-ai-chat-production.up.railway.app",this.USE_BACKEND_API=!0,this.sessionMessageCount=0,this.MAX_MESSAGES_PER_SESSION=10,this.sessionId=this.getOrCreateSessionId(),this.conversationHistory=[],this.chatWidget&&this.chatToggle&&this.chatModal?this.init():console.warn("Chatbot elements not found, skipping initialization")}init(){this.setupEventListeners(),this.setupSuggestions(),this.enableInputValidation(),this.setupTooltipIntroduction(),this.setupPeriodicGlowEffect()}getOrCreateSessionId(){const e=this.generateSessionId();return localStorage.setItem("chat_session_id",e),e}generateSessionId(){return"session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}canSendMessage(){return this.sessionMessageCount<this.MAX_MESSAGES_PER_SESSION}setupEventListeners(){this.chatToggle&&this.chatToggle.addEventListener("click",()=>{this.toggleChat()}),this.chatClose&&this.chatClose.addEventListener("click",()=>{this.closeChat()}),this.chatSend&&this.chatSend.addEventListener("click",()=>{this.sendMessage()}),this.chatInputField&&this.chatInputField.addEventListener("keypress",e=>{"Enter"===e.key&&!e.shiftKey&&this.chatInputField.value.trim()&&(e.preventDefault(),this.sendMessage())}),document.addEventListener("click",e=>{this.isOpen&&!this.chatWidget.contains(e.target)&&this.closeChat()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isOpen&&this.closeChat()})}setupSuggestions(){document.querySelectorAll(".suggestion-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.textContent;this.chatInputField.value=t,this.sendMessage()})})}enableInputValidation(){this.chatInputField&&this.chatSend&&this.chatInputField.addEventListener("input",()=>{const e=this.chatInputField.value.trim().length>0;this.chatSend.disabled=!e||this.isTyping||!this.canSendMessage()})}toggleChat(){this.isOpen?this.closeChat():this.openChat()}openChat(){this.isOpen=!0,this.chatToggle&&this.chatToggle.classList.add("active"),this.chatModal&&this.chatModal.classList.add("open"),setTimeout(()=>{this.chatInputField&&this.chatInputField.focus()},300)}closeChat(){this.isOpen=!1,this.chatToggle&&this.chatToggle.classList.remove("active"),this.chatModal&&this.chatModal.classList.remove("open")}sendMessage(){if(!this.chatInputField)return;const e=this.chatInputField.value.trim();if(e&&!this.isTyping){if(!this.canSendMessage())return this.addMessage("爪注专, 注转 转 10 注转 砖. 砖  转爪专 拽砖专 砖专转 住驻: 052-896-2110","bot"),void this.disableChatInput();this.sessionMessageCount++,this.sessionMessageCount>=this.MAX_MESSAGES_PER_SESSION&&setTimeout(()=>{this.disableChatInput()},2e3),this.addMessage(e,"user"),this.chatInputField.value="",this.chatSend&&(this.chatSend.disabled=!0),this.conversationHistory.push({role:"user",parts:[{text:e}]}),this.showTyping(),this.getAIResponse(e)}}addMessage(e,t){if(!this.chatMessages)return;const s=document.createElement("div");s.className=`message ${t}-message`;const i=(new Date).toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}),o="bot"===t?'<div class="message-avatar"><i class="fas fa-music"></i></div>':'<div class="message-avatar"><i class="fas fa-user"></i></div>',a="bot"===t?this.processTextForLinks(e):e;s.innerHTML=`\n            ${o}\n            <div class="message-content">\n                <p>${a}</p>\n                <span class="message-time">${i}</span>\n            </div>\n        `,this.chatMessages.appendChild(s),this.scrollToBottom()}showTyping(){this.isTyping=!0,this.chatTyping&&(this.chatTyping.style.display="flex"),this.chatSend&&(this.chatSend.disabled=!0),this.scrollToBottom()}hideTyping(){this.isTyping=!1,this.chatTyping&&(this.chatTyping.style.display="none"),this.chatSend&&this.chatInputField&&(this.chatSend.disabled=0===this.chatInputField.value.trim().length||!this.canSendMessage())}scrollToBottom(){this.chatMessages&&setTimeout(()=>{this.chatMessages.scrollTop=this.chatMessages.scrollHeight},100)}disableChatInput(){this.chatInputField&&(this.chatInputField.disabled=!0,this.chatInputField.placeholder="注转 转 10 注转 - 爪专 拽砖专 住驻"),this.chatSend&&(this.chatSend.disabled=!0)}isMobileDevice(){return/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}processTextForLinks(e){const t=this.isMobileDevice();let s=e;return s=s.replace(/(https?:\/\/(?:wa\.me|api\.whatsapp\.com)\/[^\s]+)/g,e=>`<a href="${e}" target="_blank" style="color: #25D366; text-decoration: underline;">爪专 拽砖专 住驻</a>`),s=s.replace(/(0\d{1,2}-?\d{3}-?\d{4})/g,e=>{const s=e.replace(/-/g,"");return t?`<a href="tel:${s}" style="color: #007bff; text-decoration: underline;">${e}</a>`:`<span style="color: #007bff; font-weight: bold;">${e}</span>`}),s}async getAIResponse(e){this.USE_BACKEND_API?await this.getBackendResponse(e):await this.getFallbackResponse(e)}async getBackendResponse(e){try{const e={messages:this.conversationHistory,session_id:this.sessionId},t=new Promise((e,t)=>setTimeout(()=>t(new Error("Request timeout")),1e4)),s=fetch(`${this.API_BASE_URL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),i=await Promise.race([s,t]);if(!i.ok)throw new Error(`Backend API Error: ${i.status}`);const o=await i.json();o.session_id&&o.session_id!==this.sessionId&&(this.sessionId=o.session_id,localStorage.setItem("chat_session_id",this.sessionId)),this.conversationHistory.push({role:"assistant",parts:[{text:o.response}]}),this.conversationHistory.length>10&&(this.conversationHistory=this.conversationHistory.slice(-8)),this.hideTyping(),this.addMessage(o.response,"bot")}catch(t){console.error("Backend API Error:",t),this.hideTyping(),t.message.includes("429")?this.addMessage("注转 转 注转 砖注转转. 砖  转爪专 拽砖专 砖专转 住驻: 052-896-2110","bot"):t.message.includes("500")?this.addMessage("砖 注 转 注专转.   住驻  砖: 052-896-2110","bot"):await this.getFallbackResponse(e)}}async getFallbackResponse(e){const t={"  驻注 专拽":"驻注 专拽 砖 : 注专转 专转 砖专  转,  拽 , 拽专驻  拽, 拽专转 , 专 拽爪注转. 拽 专 转 转 砖专 专驻专专!"," 注 驻注":"专 转 住驻专 专  住驻专 专, 砖 , 拽. 砖 转转  爪注转 专 拽转 专 砖转住驻专  注 专注 砖.  注专 住驻 驻专? 052-896-2110"," 驻注转 注专转 专转 砖专":"注专转 砖 驻砖 驻转! 专 住 转专 爪注转 QR 拽, 专 专砖 砖 转 砖专 专, 专 转 砖专 砖  .  专 转 拽砖转  转  转 驻注 转!",default:["砖 注专  注 专注!  专 转专 驻专 住驻: 052-896-2110","砖 注!   注转 注  砖转 砖 住驻: 052-896-2110","砖 注专  转 转 专注 砖!  砖 住驻: 052-896-2110"]};await new Promise(e=>setTimeout(e,1e3+1e3*Math.random()));const s=e.toLowerCase();let i=null;for(const[e,o]of Object.entries(t))if("default"!==e&&s.includes(e)){i=o;break}if(i||(s.includes("专")||s.includes("注")||s.includes("注转")?i=t[" 注 驻注"]:(s.includes("砖专")||s.includes("专驻专专")||s.includes("拽"))&&(i="专驻专专 砖 砖 转 砖专  转拽驻转: 砖专 专抓 砖专 砖, 砖 专爪, 专 , , 注 砖专 专 转专. 注专转 专拽转 专  专转 转  专砖 专!")),!i){const e=t.default;i=e[Math.floor(Math.random()*e.length)]}this.hideTyping(),this.addMessage(i,"bot")}setupTooltipIntroduction(){this.chatTooltip&&(setTimeout(()=>{this.chatTooltip.classList.add("show"),setTimeout(()=>{this.chatTooltip.classList.remove("show")},3e3)},3e3),this.chatToggle.addEventListener("click",()=>{this.chatTooltip.classList.remove("show")}))}setupPeriodicGlowEffect(){setInterval(()=>{this.isOpen||(this.chatToggle.classList.add("glow-effect"),setTimeout(()=>{this.chatToggle.classList.remove("glow-effect")},1500))},8e3)}}document.addEventListener("DOMContentLoaded",()=>{new MusicianSite,new Chatbot,PerformanceUtils.lazyLoadImages(),PerformanceUtils.preloadCriticalImages(),setTimeout(()=>{document.body.classList.add("loaded")},100)}),document.addEventListener("visibilitychange",()=>{if(document.hidden){document.querySelectorAll("video").forEach(e=>{e.paused||(e.pause(),e.dataset.wasPlaying="true")})}else{document.querySelectorAll('video[data-was-playing="true"]').forEach(e=>{e.play(),delete e.dataset.wasPlaying})}}),window.addEventListener("resize",()=>{if(window.innerWidth>768){const e=document.getElementById("nav-menu"),t=document.getElementById("hamburger");e&&t&&(e.classList.remove("active"),t.classList.remove("active"))}});