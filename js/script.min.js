class MusicianSite{constructor(){this.navbar=document.getElementById("navbar"),this.hamburger=document.getElementById("hamburger"),this.navMenu=document.getElementById("nav-menu"),this.videoModal=document.getElementById("video-modal"),this.modalVideo=document.getElementById("modal-video"),this.heroVideo=document.getElementById("hero-video"),this.videoPlayBtn=document.getElementById("video-play-btn"),this.contactForm=document.getElementById("contact-form"),this.init()}init(){this.setupNavigation(),this.setupScrollEffects(),this.setupVideoHandlers(),this.setupContactForm(),this.setupTestimonialsCarousel(),this.setupAnimations(),this.setupSmoothScrolling(),this.setupParallaxOptimizations()}setupNavigation(){this.hamburger.addEventListener("click",()=>{this.navMenu.classList.toggle("active"),this.hamburger.classList.toggle("active")}),document.querySelectorAll(".nav-link").forEach(t=>{t.addEventListener("click",()=>{this.navMenu.classList.remove("active"),this.hamburger.classList.remove("active")})}),document.addEventListener("click",t=>{this.navMenu.contains(t.target)||this.hamburger.contains(t.target)||(this.navMenu.classList.remove("active"),this.hamburger.classList.remove("active"))})}setupScrollEffects(){let t=window.scrollY;const e=document.querySelector(".hero"),s=document.querySelector(".hero-overlay"),i=document.querySelectorAll(".parallax-layer");let a=!1,n=!0;const o=new IntersectionObserver(t=>{t.forEach(t=>{n=t.isIntersecting})},{rootMargin:"100px 0px"});e&&o.observe(e);const r=()=>{const o=window.scrollY;o>100?this.navbar.classList.add("scrolled"):this.navbar.classList.remove("scrolled"),e&&n&&o<1.2*window.innerHeight&&(i.forEach(t=>{const e=parseFloat(t.dataset.speed)||0,s=o*e;t.style.transform=`translate3d(0, ${s}px, 0)`}),s&&(s.style.transform=`translate3d(0, ${.4*o}px, 0)`)),this.updateActiveNavLink(),t=o,a=!1};window.addEventListener("scroll",()=>{a||(requestAnimationFrame(r),a=!0)},{passive:!0}),r()}updateActiveNavLink(){const t=document.querySelectorAll("section[id]"),e=window.scrollY+100;t.forEach(t=>{const s=t.offsetTop,i=t.offsetHeight,a=t.getAttribute("id"),n=document.querySelector(`.nav-link[href="#${a}"]`);e>=s&&e<s+i&&(document.querySelectorAll(".nav-link").forEach(t=>{t.classList.remove("active")}),n&&n.classList.add("active"))})}setupVideoHandlers(){document.querySelectorAll(".play-btn").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const s=t.getAttribute("data-video");this.openVideoModal(s)})});const t=document.querySelector(".video-modal-close");t&&t.addEventListener("click",()=>{this.closeVideoModal()}),this.videoModal&&this.videoModal.addEventListener("click",t=>{t.target===this.videoModal&&this.closeVideoModal()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.closeVideoModal()}),window.addEventListener("popstate",t=>{this.videoModal&&"block"===this.videoModal.style.display&&this.closeVideoModal(!0)})}openVideoModal(t,e=!1){this.videoModal&&this.modalVideo&&(this.modalVideo.src=t,this.videoModal.style.display="block",document.body.style.overflow="hidden",e||history.pushState({modalOpen:!0},"",""),setTimeout(()=>{this.modalVideo.play().catch(t=>{console.log("Auto-play prevented:",t)})},100))}closeVideoModal(t=!1){if(this.videoModal&&this.modalVideo){this.videoModal.style.display="none",this.modalVideo.pause(),this.modalVideo.src="",document.body.style.overflow="auto";if(window.location.pathname.match(/^\/video\/(.+)$/)){window.history.pushState(null,"砖专 爪专 拽爪注转 |   - 拽  砖专","/"),document.title="砖专 爪专 拽爪注转 |   - 拽  砖专";const t=document.querySelector('link[rel="canonical"]');t&&(t.href="https://singwithalon.com/")}else!t&&window.history.state&&window.history.state.modalOpen&&history.back()}}setupContactForm(){this.contactForm&&this.contactForm.addEventListener("submit",t=>{t.preventDefault(),this.handleFormSubmission()})}async handleFormSubmission(){const t=new FormData(this.contactForm),e=Object.fromEntries(t),s=FormValidator.validateForm(e);if(s.length>0)return void this.showMessage(s.join("\n"),"error");const i=this.contactForm.querySelector('button[type="submit"]'),a=i.innerHTML;i.innerHTML='<i class="fas fa-spinner fa-spin"></i> 爪专 注...',i.disabled=!0;try{await this.sendWhatsAppMessage(e)}catch(t){console.error("WhatsApp message error:",t),this.showMessage("砖 爪专转 注转 WhatsApp.  住 砖.","error")}finally{i.innerHTML=a,i.disabled=!1}}async sendWhatsAppMessage(t){const e=t.date?new Date(t.date).toLocaleDateString("he-IL"):" 爪",s=`砖 ! \n\n 注/转  驻注:\n\n 砖: ${t.name}\n 驻: ${t.phone}\n 转专 注祝: ${e}\n\n 驻专 住驻:\n${t.message||" 爪 驻专 住驻"}\n\n砖 砖注  拽! `,i=`https://wa.me/972528962110?text=${encodeURIComponent(s)}`;await new Promise(t=>setTimeout(t,1e3));try{const t=window.open(i,"_blank","noopener,noreferrer");!t||t.closed||void 0===t.closed?window.location.href=i:(this.showMessage("注转 WhatsApp 爪专 爪! 驻驻 驻转 注 专注.","success"),this.contactForm.reset())}catch(t){console.log("Popup failed, using direct navigation:",t),window.location.href=i}return!0}showMessage(t,e){document.querySelectorAll(".form-message").forEach(t=>t.remove());const s=document.createElement("div");s.className=`form-message ${e}`,s.innerHTML=`\n            <i class="fas fa-${"success"===e?"check-circle":"exclamation-circle"}"></i>\n            <span>${t}</span>\n        `,s.style.cssText=`\n            display: flex;\n            align-items: center;\n            gap: 10px;\n            padding: 15px 20px;\n            margin-top: 20px;\n            border-radius: 10px;\n            font-weight: 500;\n            background: ${"success"===e?"#d4edda":"#f8d7da"};\n            color: ${"success"===e?"#155724":"#721c24"};\n            border: 1px solid ${"success"===e?"#c3e6cb":"#f5c6cb"};\n        `,this.contactForm.appendChild(s),setTimeout(()=>{s.remove()},5e3)}setupTestimonialsCarousel(){const t=document.querySelector(".testimonials-carousel");t&&(this.testimonialsCarousel=new TestimonialsCarousel(t))}setupAnimations(){const t=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&t.target.classList.add("visible")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".service-card, .testimonial-card, .video-card, .highlight-item").forEach(e=>{e.classList.add("fade-in"),t.observe(e)}),document.querySelectorAll(".services-grid .service-card").forEach((t,e)=>{t.style.animationDelay=.2*e+"s"}),document.querySelectorAll(".testimonials-grid .testimonial-card").forEach((t,e)=>{t.style.animationDelay=.2*e+"s"}),document.querySelectorAll(".videos-grid .video-card").forEach((t,e)=>{t.style.animationDelay=.1*e+"s"})}setupSmoothScrolling(){document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const s=t.getAttribute("href"),i=document.querySelector(s);if(i){const t=i.offsetTop-80;window.scrollTo({top:t,behavior:"smooth"})}})});const t=document.querySelector(".scroll-indicator");t&&t.addEventListener("click",()=>{const t=document.getElementById("about");t&&t.scrollIntoView({behavior:"smooth",block:"start"})})}setupParallaxOptimizations(){(navigator.hardwareConcurrency<=4||window.devicePixelRatio<1.5||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))&&document.querySelectorAll(".parallax-layer").forEach(t=>{t.style.filter="none"}),document.addEventListener("visibilitychange",()=>{const t=document.querySelectorAll(".parallax-layer");document.hidden?t.forEach(t=>{t.style.willChange="auto"}):t.forEach(t=>{t.style.willChange="transform"})});const t=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting?document.body.classList.add("parallax-active"):document.body.classList.remove("parallax-active")})},{threshold:.1}),e=document.querySelector(".hero");e&&t.observe(e)}debounce(t,e){let s;return function(...i){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),t(...i)},e)}}throttle(t,e){let s;return function(){const i=arguments,a=this;s||(t.apply(a,i),s=!0,setTimeout(()=>s=!1,e))}}}class FormValidator{static validateEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}static validatePhone(t){return/^(\+972|0)([23489]|5[02468]|77)[0-9]{7}$/.test(t.replace(/[- ]/g,""))}static validateForm(t){const e=[];if((!t.name||t.name.length<2)&&e.push("砖    驻转 2 转"),FormValidator.validatePhone(t.phone)||e.push("住驻专 驻  转拽"),t.date){const s=new Date(t.date),i=new Date;i.setHours(0,0,0,0),s<i&&e.push("转专  转   注转")}else e.push("砖 专 转专");return e}}class PerformanceUtils{static lazyLoadImages(){if("IntersectionObserver"in window){const t=new IntersectionObserver((t,e)=>{t.forEach(t=>{if(t.isIntersecting){const s=t.target;s.src=s.dataset.src,s.classList.remove("lazy"),e.unobserve(s)}})});document.querySelectorAll("img[data-src]").forEach(e=>{t.observe(e)})}}static preloadCriticalImages(){}}const testimonialsData=[{stars:5,text:"注专转 砖 专转 砖专 驻砖 转!  专 专 转 砖专 砖   专 转 .  注 拽  拽专 转 拽 转 转 注爪 爪 专. 拽 砖 驻砖 拽住!",author:"砖驻转 砖",event:"专注 拽抓"},{stars:5,text:" 转   转 65 砖 .   转  砖专 专抓 砖专 砖 砖   转 - 砖 专爪, 专 , .   砖! 专 转  住转 拽  砖专爪.",author:"砖驻转 专专",event:"住转  转 驻专转"},{stars:5,text:" 驻砖     爪 爪专 转砖 砖 拽 砖 专 ! 拽, 专, 转驻 -  住专 砖. 住祝    转 注专 爪专   驻转. 爪 !",author:"专 注拽 ",event:"专注 砖驻转 拽"},{stars:5,text:" 转  专注 砖转 砖 专 砖.  砖 驻转注 转    爪 专  专转 - 爪注专 砖专 注 专 转 转转. 注专转 转 砖 驻砖专转   转专 专. 住祝  拽砖 注转 转 专注 !",author:"爪转 砖专 拽转,  ",event:"专注 专 - 60 砖转转驻"},{stars:5,text:"拽住  专 砖   拽 转  砖专爪 -  驻住转专 专砖  砖转 爪专 砖转  专 专转 转 住 驻  砖  .  爪 爪专 专 专砖转 转, 转 , 砖 注 砖 砖专 拽,   转 注 专 砖 爪专 专转 砖专 转  爪专 专砖 转 砖 转 专.",author:"拽转 状 专转状, 专转 ",event:"拽住  专"}];class TestimonialsCarousel{constructor(t,e={}){this.container=t,this.track=t.querySelector(".carousel-track"),this.prevBtn=t.querySelector(".carousel-btn.prev"),this.nextBtn=t.querySelector(".carousel-btn.next"),this.currentIndex=0,this.totalCards=testimonialsData.length,this.isRTL="rtl"===document.dir,this.isAnimating=!1,this.autoAdvance=e.autoAdvance??!0,this.interval=e.interval??7e3,this.autoplayTimer=null,this.mobileBreakpoint=768,this.allCards=[],this.cardWidth=0,this.visibleCards=3,this.init()}init(){this.setupEventListeners(),this.checkReducedMotion(),this.createAllCards(),this.updateLayout(),this.setupAccessibility(),this.autoAdvance&&this.startAutoplay(),window.addEventListener("resize",this.debounce(()=>{this.updateLayout()},300))}checkReducedMotion(){this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches}setupEventListeners(){this.prevBtn?.addEventListener("click",()=>this.goToPrevious()),this.nextBtn?.addEventListener("click",()=>this.goToNext()),this.container.addEventListener("mouseenter",()=>this.pauseAutoplay()),this.container.addEventListener("mouseleave",()=>this.resumeAutoplay()),this.container.addEventListener("focusin",()=>this.pauseAutoplay()),this.container.addEventListener("focusout",()=>this.resumeAutoplay()),this.setupTouchEvents(),this.container.addEventListener("keydown",t=>this.handleKeydown(t))}setupTouchEvents(){let t=0,e=0,s=!1,i=0;this.track.addEventListener("touchstart",a=>{t=a.touches[0].clientX,e=a.touches[0].clientY,s=!0,i=0,this.pauseAutoplay(),this.track.classList.add("touch-active")},{passive:!0}),this.track.addEventListener("touchmove",a=>{if(!s)return;const n=a.touches[0].clientX,o=a.touches[0].clientY,r=t-n,c=e-o;if(Math.abs(r)>Math.abs(c)){a.preventDefault(),i=-r;const t=.3*window.innerWidth;i=Math.max(-t,Math.min(t,i)),this.track.style.transform=`translateX(${i}px)`}},{passive:!1}),this.track.addEventListener("touchend",e=>{if(!s)return;const i=e.changedTouches[0].clientX,a=t-i;this.track.classList.remove("touch-active"),this.track.style.transform="",this.track.style.transition="",Math.abs(a)>50&&(this.isRTL?a>0?this.goToPrevious():this.goToNext():a>0?this.goToNext():this.goToPrevious()),s=!1,this.resumeAutoplay()},{passive:!0})}setupAccessibility(){this.updateAriaStates(),this.track&&(this.track.setAttribute("tabindex","0"),this.track.setAttribute("role","group"),this.track.setAttribute("aria-label","拽专住转 爪转"))}handleKeydown(t){switch(t.key){case"ArrowLeft":t.preventDefault(),this.isRTL?this.goToNext():this.goToPrevious();break;case"ArrowRight":t.preventDefault(),this.isRTL?this.goToPrevious():this.goToNext();break;case"Home":t.preventDefault(),this.goToSlide(0);break;case"End":t.preventDefault(),this.goToSlide(this.totalCards-1)}}goToNext(){this.isAnimating||(this.currentIndex=(this.currentIndex+1)%this.totalCards,this.slideToCurrentIndex())}goToPrevious(){this.isAnimating||(this.currentIndex=(this.currentIndex-1+this.totalCards)%this.totalCards,this.slideToCurrentIndex())}goToSlide(t){this.isAnimating||t===this.currentIndex||(this.currentIndex=t,this.slideToCurrentIndex())}createAllCards(){this.track&&(this.track.innerHTML="",this.allCards=[],testimonialsData.forEach((t,e)=>{const s=document.createElement("div");s.className="testimonial-card",s.dataset.testimonialIndex=e,s.innerHTML=this.createTestimonialCardHTML(t,e),this.track.appendChild(s),this.allCards.push(s)}))}createTestimonialCardHTML(t,e){return`\n            <div class="testimonial-content">\n                <div class="stars">\n                    ${Array(t.stars).fill('<i class="fas fa-star"></i>').join("")}\n                </div>\n                <p>"${t.text}"</p>\n            </div>\n            <div class="testimonial-author">\n                <div class="author-icon">\n                    <i class="fas fa-user-circle"></i>\n                </div>\n                <div class="author-info">\n                    <h3>${t.author}</h3>\n                    <span>${t.event}</span>\n                </div>\n            </div>\n        `}updateLayout(){const t=window.innerWidth<this.mobileBreakpoint;this.visibleCards=t?1:3,t||this.updateDesktopCards();const e=this.container.offsetWidth,s=t?20:112;this.cardWidth=(e-s-20*(this.visibleCards-1))/this.visibleCards,this.allCards.forEach((t,e)=>{t.style.minWidth=`${this.cardWidth}px`,t.style.maxWidth=`${this.cardWidth}px`,t.style.flex="none"}),this.slideToCurrentIndex(!1)}slideToCurrentIndex(t=!0){if(!this.track||0===this.allCards.length)return;this.isAnimating=t;let e=0;window.innerWidth<this.mobileBreakpoint?e=this.currentIndex*(this.cardWidth+20):(this.updateDesktopCards(),e=0);const s=this.isRTL?e:-e;t&&!this.prefersReducedMotion?this.track.style.transition="transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)":this.track.style.transition="none",this.track.style.transform=`translateX(${s}px)`,this.updateAriaStates(),this.announceSlide(),t?setTimeout(()=>{this.isAnimating=!1},500):this.isAnimating=!1}updateDesktopCards(){if(!(window.innerWidth<this.mobileBreakpoint||this.allCards.length<3)){for(;this.allCards.length>3;){const t=this.allCards.pop();t&&t.parentNode&&t.parentNode.removeChild(t)}for(;this.allCards.length<3;){const t=document.createElement("div");t.className="testimonial-card",this.track.appendChild(t),this.allCards.push(t)}for(let t=0;t<3;t++){const e=(this.currentIndex+t)%this.totalCards,s=testimonialsData[e];this.allCards[t]&&s&&(this.allCards[t].dataset.testimonialIndex=e,this.allCards[t].innerHTML=this.createTestimonialCardHTML(s,e))}}}updateAriaStates(){this.container.querySelectorAll(".testimonial-card").forEach(t=>{t.setAttribute("aria-hidden",!1)})}announceSlide(){const t=`爪 ${this.currentIndex+1} 转 ${this.totalCards}`;let e=this.container.querySelector(".sr-only");e||(e=document.createElement("div"),e.className="sr-only",e.setAttribute("aria-live","polite"),e.style.cssText="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0;",this.container.appendChild(e)),e.textContent=t}startAutoplay(){this.autoAdvance&&(this.autoplayTimer=setInterval(()=>{this.goToNext()},this.interval))}pauseAutoplay(){this.autoplayTimer&&(clearInterval(this.autoplayTimer),this.autoplayTimer=null)}resumeAutoplay(){this.autoAdvance&&!this.autoplayTimer&&this.startAutoplay()}debounce(t,e){let s;return function(...i){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),t(...i)},e)}}destroy(){this.pauseAutoplay(),this.container=null,this.track=null}}class Chatbot{constructor(){this.chatWidget=document.getElementById("chatbot-widget"),this.chatToggle=document.getElementById("chat-toggle"),this.chatModal=document.getElementById("chat-modal"),this.chatClose=document.getElementById("chat-close"),this.chatMessages=document.getElementById("chat-messages"),this.chatInputField=document.getElementById("chat-input-field"),this.chatSend=document.getElementById("chat-send"),this.chatTyping=document.getElementById("chat-typing"),this.chatTooltip=document.getElementById("chat-tooltip"),this.isOpen=!1,this.isTyping=!1,this.API_BASE_URL="https://singwithalon-ai-chat-production.up.railway.app",this.USE_BACKEND_API=!0,this.sessionMessageCount=0,this.MAX_MESSAGES_PER_SESSION=10,this.sessionId=this.getOrCreateSessionId(),this.conversationHistory=[],this.chatWidget&&this.chatToggle&&this.chatModal?this.init():console.warn("Chatbot elements not found, skipping initialization")}init(){this.setupEventListeners(),this.setupSuggestions(),this.enableInputValidation(),this.setupTooltipIntroduction(),this.setupPeriodicGlowEffect()}getOrCreateSessionId(){const t=this.generateSessionId();return localStorage.setItem("chat_session_id",t),t}generateSessionId(){return"session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}canSendMessage(){return this.sessionMessageCount<this.MAX_MESSAGES_PER_SESSION}setupEventListeners(){this.chatToggle&&this.chatToggle.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.chatToggle.disabled||this.toggleChat()}),this.chatClose&&this.chatClose.addEventListener("click",()=>{this.closeChat()}),this.chatSend&&this.chatSend.addEventListener("click",()=>{this.sendMessage()}),this.chatInputField&&this.chatInputField.addEventListener("keypress",t=>{"Enter"===t.key&&!t.shiftKey&&this.chatInputField.value.trim()&&(t.preventDefault(),this.sendMessage())}),document.addEventListener("click",t=>{this.isOpen&&!this.chatWidget.contains(t.target)&&this.closeChat()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.isOpen&&this.closeChat()})}setupSuggestions(){document.querySelectorAll(".suggestion-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.textContent;this.chatInputField.value=e,this.sendMessage()})})}enableInputValidation(){this.chatInputField&&this.chatSend&&this.chatInputField.addEventListener("input",()=>{const t=this.chatInputField.value.trim().length>0;this.chatSend.disabled=!t||this.isTyping||!this.canSendMessage()})}toggleChat(){this.isOpen?this.closeChat():this.openChat()}openChat(){this.isOpen||(this.isOpen=!0,this.chatToggle&&(this.chatToggle.disabled=!0,this.chatToggle.classList.add("active"),setTimeout(()=>{this.chatToggle.disabled=!1},300)),this.chatModal&&this.chatModal.classList.add("open"),setTimeout(()=>{this.chatInputField&&this.chatInputField.focus()},300))}closeChat(){this.isOpen&&(this.isOpen=!1,this.chatToggle&&(this.chatToggle.disabled=!0,this.chatToggle.classList.remove("active"),setTimeout(()=>{this.chatToggle.disabled=!1},300)),this.chatModal&&this.chatModal.classList.remove("open"))}sendMessage(){if(!this.chatInputField)return;const t=this.chatInputField.value.trim();if(t&&!this.isTyping){if(!this.canSendMessage())return this.addMessage("爪注专, 注转 转 10 注转 砖. 砖  转爪专 拽砖专 砖专转 住驻: 052-896-2110","bot"),void this.disableChatInput();this.sessionMessageCount++,this.sessionMessageCount>=this.MAX_MESSAGES_PER_SESSION&&setTimeout(()=>{this.disableChatInput()},2e3),this.addMessage(t,"user"),this.chatInputField.value="",this.chatSend&&(this.chatSend.disabled=!0),this.conversationHistory.push({role:"user",parts:[{text:t}]}),this.showTyping(),this.getAIResponse(t)}}addMessage(t,e){if(!this.chatMessages)return;const s=document.createElement("div");s.className=`message ${e}-message`;const i=(new Date).toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}),a="bot"===e?'<div class="message-avatar"><i class="fas fa-music"></i></div>':'<div class="message-avatar"><i class="fas fa-user"></i></div>',n="bot"===e?this.processTextForLinks(t):t;s.innerHTML=`\n            ${a}\n            <div class="message-content">\n                <p>${n}</p>\n                <span class="message-time">${i}</span>\n            </div>\n        `,this.chatMessages.appendChild(s),this.scrollToBottom()}showTyping(){this.isTyping=!0,this.chatTyping&&(this.chatTyping.style.display="flex"),this.chatSend&&(this.chatSend.disabled=!0),this.scrollToBottom()}hideTyping(){this.isTyping=!1,this.chatTyping&&(this.chatTyping.style.display="none"),this.chatSend&&this.chatInputField&&(this.chatSend.disabled=0===this.chatInputField.value.trim().length||!this.canSendMessage())}scrollToBottom(){this.chatMessages&&setTimeout(()=>{this.chatMessages.scrollTop=this.chatMessages.scrollHeight},100)}disableChatInput(){this.chatInputField&&(this.chatInputField.disabled=!0,this.chatInputField.placeholder="注转 转 10 注转 - 爪专 拽砖专 住驻"),this.chatSend&&(this.chatSend.disabled=!0)}isMobileDevice(){return/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}processTextForLinks(t){const e=this.isMobileDevice();let s=t;return s=s.replace(/(https?:\/\/(?:wa\.me|api\.whatsapp\.com)\/[^\s]+)/g,t=>`<a href="${t}" target="_blank" style="color: #25D366; text-decoration: underline;">爪专 拽砖专 住驻</a>`),s=s.replace(/(0\d{1,2}-?\d{3}-?\d{4})/g,t=>{const s=t.replace(/-/g,"");return e?`<a href="tel:${s}" style="color: #007bff; text-decoration: underline;">${t}</a>`:`<span style="color: #007bff; font-weight: bold;">${t}</span>`}),s}async getAIResponse(t){this.USE_BACKEND_API?await this.getBackendResponse(t):await this.getFallbackResponse(t)}async getBackendResponse(t){try{const t={messages:this.conversationHistory,session_id:this.sessionId},e=new Promise((t,e)=>setTimeout(()=>e(new Error("Request timeout")),1e4)),s=fetch(`${this.API_BASE_URL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),i=await Promise.race([s,e]);if(!i.ok)throw new Error(`Backend API Error: ${i.status}`);const a=await i.json();a.session_id&&a.session_id!==this.sessionId&&(this.sessionId=a.session_id,localStorage.setItem("chat_session_id",this.sessionId)),this.conversationHistory.push({role:"assistant",parts:[{text:a.response}]}),this.conversationHistory.length>10&&(this.conversationHistory=this.conversationHistory.slice(-8)),this.hideTyping(),this.addMessage(a.response,"bot")}catch(e){console.error("Backend API Error:",e),this.hideTyping(),e.message.includes("429")?this.addMessage("注转 转 注转 砖注转转. 砖  转爪专 拽砖专 砖专转 住驻: 052-896-2110","bot"):e.message.includes("500")?this.addMessage("砖 注 转 注专转.   住驻  砖: 052-896-2110","bot"):await this.getFallbackResponse(t)}}async getFallbackResponse(t){const e={"  驻注 专拽":"驻注 专拽 砖 : 注专转 专转 砖专  转,  拽 , 拽专驻  拽, 拽专转 , 专 拽爪注转. 拽 专 转 转 砖专 专驻专专!"," 注 驻注":"专 转 住驻专 专  住驻专 专, 砖 , 拽. 砖 转转  爪注转 专 拽转 专 砖转住驻专  注 专注 砖.  注专 住驻 驻专? 052-896-2110"," 驻注转 注专转 专转 砖专":"注专转 砖 驻砖 驻转! 专 住 转专 爪注转 QR 拽, 专 专砖 砖 转 砖专 专, 专 转 砖专 砖  .  专 转 拽砖转  转  转 驻注 转!",default:["砖 注专  注 专注!  专 转专 驻专 住驻: 052-896-2110","砖 注!   注转 注  砖转 砖 住驻: 052-896-2110","砖 注专  转 转 专注 砖!  砖 住驻: 052-896-2110"]};await new Promise(t=>setTimeout(t,1e3+1e3*Math.random()));const s=t.toLowerCase();let i=null;for(const[t,a]of Object.entries(e))if("default"!==t&&s.includes(t)){i=a;break}if(i||(s.includes("专")||s.includes("注")||s.includes("注转")?i=e[" 注 驻注"]:(s.includes("砖专")||s.includes("专驻专专")||s.includes("拽"))&&(i="专驻专专 砖 砖 转 砖专  转拽驻转: 砖专 专抓 砖专 砖, 砖 专爪, 专 , , 注 砖专 专 转专. 注专转 专拽转 专  专转 转  专砖 专!")),!i){const t=e.default;i=t[Math.floor(Math.random()*t.length)]}this.hideTyping(),this.addMessage(i,"bot")}setupTooltipIntroduction(){this.chatTooltip&&(setTimeout(()=>{this.chatTooltip.classList.add("show"),setTimeout(()=>{this.chatTooltip.classList.remove("show")},3e3)},3e3),this.chatToggle.addEventListener("click",()=>{this.chatTooltip.classList.remove("show")}))}setupPeriodicGlowEffect(){setInterval(()=>{this.isOpen||(this.chatToggle.classList.add("glow-effect"),setTimeout(()=>{this.chatToggle.classList.remove("glow-effect")},1500))},8e3)}}document.addEventListener("DOMContentLoaded",()=>{new MusicianSite,new Chatbot,PerformanceUtils.lazyLoadImages(),PerformanceUtils.preloadCriticalImages(),setTimeout(()=>{document.body.classList.add("loaded")},100)}),document.addEventListener("visibilitychange",()=>{if(document.hidden){document.querySelectorAll("video").forEach(t=>{t.paused||(t.pause(),t.dataset.wasPlaying="true")})}else{document.querySelectorAll('video[data-was-playing="true"]').forEach(t=>{t.play(),delete t.dataset.wasPlaying})}}),window.addEventListener("resize",()=>{if(window.innerWidth>768){const t=document.getElementById("nav-menu"),e=document.getElementById("hamburger");t&&e&&(t.classList.remove("active"),e.classList.remove("active"))}});